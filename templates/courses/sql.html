<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Course | ErikodxIT</title>
  <style>
    /* Same CSS as your Python course */
    body { margin:0; background:#0a0a23; color:#fff; font-family:'Segoe UI',sans-serif; display:flex; height:100vh; overflow:hidden; }
    .sidebar { width:280px; background:#12123a; overflow-y:auto; padding:25px; box-shadow:2px 0 10px rgba(0,255,255,0.1); }
    .sidebar h2 { color:#00c2ff; margin-bottom:20px; font-size:1.4em; }
    .video-item { background:#1e1e40; border:1px solid transparent; border-radius:10px; padding:12px; margin-bottom:12px; cursor:pointer; transition:0.3s; }
    .video-item.locked { opacity:0.5; pointer-events:none; }
    .video-item:hover, .video-item.active { border-color:#00c2ff; background:#2a2a5a; transform:scale(1.02); }
    .main-content { flex:1; padding:40px 30px; overflow-y:auto; background:#0f0f2b; }
    h1 { color:#00c2ff; margin-bottom:10px; }
    .video-title { margin:20px 0 10px; font-weight:bold; font-size:1.2em; color:#f0f8ff; }
    video { width:100%; max-height:500px; border:3px solid #00c2ff; border-radius:12px; }
    .next-quiz { margin-top:20px; }
    .next-quiz a { display:inline-block; padding:10px 20px; background:#00c2ff; color:#000; font-weight:bold; border-radius:25px; text-decoration:none; margin-right:10px; margin-bottom:10px; }
    .progress-bar { margin-top:25px; height:25px; background:#333; border-radius:20px; overflow:hidden; box-shadow:inset 0 0 5px #000; }
    .progress-bar-fill { height:100%; background:#00c2ff; width:0; text-align:center; line-height:25px; font-weight:bold; color:#000; }
    .chat-box { margin-top:50px; background:#12123a; padding:20px; border-radius:12px; box-shadow:0 0 10px rgba(0,255,255,0.1); }
    .chat-box h3 { margin-top:0; color:#00c2ff; }
    .chat-box textarea { width:100%; height:80px; background:#0a0a23; color:#fff; border:1px solid #00c2ff; border-radius:8px; padding:10px; resize:vertical; }
    .chat-box button { margin-top:10px; background:#00c2ff; border:none; color:#000; padding:10px 25px; font-weight:bold; border-radius:25px; cursor:pointer; }
    .ai-button { position:fixed; bottom:25px; right:25px; background:#00c2ff; color:#000; padding:15px 20px; border-radius:50%; font-size:1.4em; box-shadow:0 0 12px #00c2ff; cursor:pointer; z-index:999; }
    .ai-popup { display:none; position:fixed; bottom:90px; right:25px; width:300px; background:#1e1e3f; border-radius:10px; padding:15px; color:#fff; box-shadow:0 0 20px #00c2ff; z-index:999; }
    .ai-popup textarea { width:100%; padding:10px; border-radius:8px; border:none; resize:none; background:#12123a; color:#fff; margin-top:10px; }
    .ai-popup button { margin-top:10px; width:100%; background:#00c2ff; border:none; padding:10px; border-radius:8px; cursor:pointer; color:#000; font-weight:bold; }
    @media (max-width:768px) {
      body { flex-direction:column; }
      .sidebar { width:100%; height:180px; overflow-x:auto; white-space:nowrap; }
      .video-item { display:inline-block; width:200px; margin-right:10px; }
      .main-content { padding:20px; }
    }
  </style>
</head>
<body>
  <div class="sidebar" id="video-list">
    <h2>ðŸ“‚ SQL Lessons</h2>
  </div>

  <div class="main-content">
    <h1>ðŸ—„ SQL Course</h1>
    <p>Learn how to query, manipulate, and manage databases using SQL, from beginner to advanced level.</p>

    <div class="video-title" id="video-title">Loading...</div>
    <video id="main-video" controls>
      <source src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <div class="next-quiz" id="quiz-link"></div>

    <div class="progress-bar">
      <div class="progress-bar-fill" id="progress-fill">0%</div>
    </div>

    <div class="chat-box">
      <h3>Ask Your Instructor</h3>
      <form method="POST" action="{{ url_for('ask_question', course_slug='sql') }}">
        <textarea name="question" placeholder="Type your question or feedback here..." required></textarea>
        <button type="submit">Send Question</button>
      </form>
    </div>

    <!-- AI Assistant -->
    <div class="ai-button" onclick="toggleAIPopup()">ðŸ¤–</div>
    <div class="ai-popup" id="aiPopup">
      <strong>Ask Erikodx AI</strong>
      <textarea placeholder="Type your question..."></textarea>
      <button onclick="alert('AI is thinking...')">Send</button>
    </div>
  </div>

  <script>
    const videos = Array.from({ length: 20 }, (_, i) => ({
      title: `Lesson ${i + 1}: SQL Topic ${i + 1}`,
      file: `/static/video/sql/${i + 1}.mp4`
    }));

    let userProgress = parseInt(localStorage.getItem("sql_progress")) || 0;
    const mainVideo = document.getElementById("main-video");
    const videoTitle = document.getElementById("video-title");
    const videoList = document.getElementById("video-list");
    const quizLink = document.getElementById("quiz-link");
    const progressFill = document.getElementById("progress-fill");

    function updateProgressBar() {
      const percent = Math.floor((userProgress / (videos.length - 1)) * 100);
      progressFill.style.width = `${percent}%`;
      progressFill.textContent = `${percent}%`;
    }

    function loadVideo(index) {
      const video = videos[index];
      mainVideo.querySelector("source").src = video.file;
      mainVideo.load();
      videoTitle.textContent = video.title;

      document.querySelectorAll('.video-item').forEach(v => v.classList.remove("active"));
      document.querySelectorAll('.video-item')[index].classList.add("active");

      quizLink.innerHTML = `
        <a href="/quiz/sql/${index + 1}">ðŸŽ¯ Take Quiz</a>
        <a href="/materials/sql/${index + 1}">ðŸ“„ Notes</a>
      `;

      if (index === videos.length - 1 && userProgress >= index) {
        quizLink.innerHTML += `<br><a href="/certificate/sql" style="background:#00ffcc;">ðŸŽ“ Download Certificate</a>`;
      }

      mainVideo.onended = () => {
        if (index >= userProgress && index + 1 < videos.length) {
          userProgress = index + 1;
          localStorage.setItem("sql_progress", userProgress);
          document.querySelectorAll('.video-item')[index + 1]?.classList.remove("locked");
          updateProgressBar();
        }
      };
    }

    videos.forEach((video, index) => {
      const div = document.createElement("div");
      div.className = "video-item" + (index > userProgress ? " locked" : "");
      div.innerText = video.title;
      if (index <= userProgress) div.onclick = () => loadVideo(index);
      videoList.appendChild(div);
    });

    if (videos.length) {
      loadVideo(userProgress);
      updateProgressBar();
    }

    function toggleAIPopup() {
      const popup = document.getElementById("aiPopup");
      popup.style.display = (popup.style.display === "none" || popup.style.display === "") ? "block" : "none";
    }
  </script>
</body>
</html>
